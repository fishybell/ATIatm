cd /home/root

rmmod *.ko 2>/dev/null
rmmod *.ko 2>/dev/null

insmod target.ko
insmod target_battery.ko minvoltval=48 charge=1
insmod target_user_interface.ko mover=1
insmod target_mover_armor.ko reverse=0
insmod target_mover_position.ko
insmod target_hit_mechanical.ko

SERVER_START="radio_conv -s /dev/ttyS1"
FASIT_START="python fasit_client_main.py -t MAT"
SERVER_STOP="killall radio_conv"
FASIT_STOP="killall python"
network=$(/usr/bin/is_comm)
if [ "$network" = "network" ] ; then
    ip_address=$(/usr/bin/is_ip)
    SERVER_START="echo -n"
    FASIT_START="python fasit_client_main.py -t MAT -s $ip_address"
    killall ping
    ping -q $ip_address &
fi

if [ -n "$1" ] ; then
    case "$1" in
    start)
        $SERVER_START &
        cd /home/root/fasit
        $FASIT_START &
        ;;
    stop)
        $SERVER_STOP
        $FASIT_STOP
        ;;
    force-reload|restart)
        $SERVER_STOP
        $FASIT_STOP
        $SERVER_START &
        cd /home/root/fasit
        $FASIT_START &
        ;;
    *)
        echo "bad command"
        ;;
    esac
else
    $SERVER_STOP
    $FASIT_STOP
fi

